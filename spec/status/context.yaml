name: "status command"
description: "Show features applied to a target project"

before_each:
  run: |
    mkdir -p ${SCENARIO_OUTPUT}/target
  timeout: 5s

scenarios:
  - id: no_templater_directory
    name: "No .templater directory shows no features"
    run:
      command: ${TEMPLATER} status ${SCENARIO_OUTPUT}/target
      timeout: 5s
    assertions:
      - command: assert_equals no_features.fixture ${RUN_OUTPUT}/stdout
      - command: assert_equals 0 ${RUN_OUTPUT}/exit_code

  - id: empty_applied_yml
    name: "Empty applied.yml shows no features"
    before:
      run: |
        mkdir -p ${SCENARIO_OUTPUT}/target/.templater
        echo "applied:" > ${SCENARIO_OUTPUT}/target/.templater/applied.yml
      timeout: 5s
    run:
      command: ${TEMPLATER} status ${SCENARIO_OUTPUT}/target
      timeout: 5s
    assertions:
      - command: assert_equals no_features.fixture ${RUN_OUTPUT}/stdout
      - command: assert_equals 0 ${RUN_OUTPUT}/exit_code

  - id: shows_applied_features
    name: "Shows list of applied features"
    before:
      run: |
        mkdir -p ${SCENARIO_OUTPUT}/target/.templater
        cat > ${SCENARIO_OUTPUT}/target/.templater/applied.yml << 'EOF'
        applied:
          - auth
          - auth/oauth
          - auth/oauth/google
        EOF
      timeout: 5s
    run:
      command: ${TEMPLATER} status ${SCENARIO_OUTPUT}/target
      timeout: 5s
    assertions:
      - command: assert_equals applied_features.fixture ${RUN_OUTPUT}/stdout
      - command: assert_equals 0 ${RUN_OUTPUT}/exit_code

  - id: nonexistent_directory
    name: "Nonexistent target directory returns error"
    run:
      command: ${TEMPLATER} status ${SCENARIO_OUTPUT}/nonexistent
      timeout: 5s
    assertions:
      - command: assert_contains "not found" ${RUN_OUTPUT}/stderr
      - command: assert_gt ${RUN_OUTPUT}/exit_code 0
